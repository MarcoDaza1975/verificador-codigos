<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Verificador simple</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Verificador SIMPLE (TEST)</h1>
  <p>Si ves este texto en Vercel, ya est√°s usando la versi√≥n nueva.</p>

  <h2>Paso 1: C√≥digo</h2>
  <form id="form-codigo">
    <input type="text" id="codigo" placeholder="C√≥digo (ej: SKM-8Q2L9D)" />
    <button type="submit">Verificar c√≥digo</button>
  </form>
  <p id="codigo-status"></p>

  <div id="lead-section" style="display:none; margin-top:20px;">
    <h2>Paso 2: Datos del cliente</h2>
    <form id="form-lead">
      <input type="text" id="nombre" placeholder="Nombre" /><br><br>
      <input type="text" id="telefono" placeholder="Tel√©fono" /><br><br>
      <button type="submit">Enviar datos</button>
    </form>
    <p id="lead-status"></p>
  </div>

  <script>
    // üëâ Pega aqu√≠ la URL REAL de tu Web App (la que probaste con nombre=Test...)
    const LEAD_ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbxfG5U_PLChNVvWSctLHvH5wW7LcxbhThF32xUMpbOXggvMK9Eht1pLviyglW6XYyzs/exec";

    // C√≥digos v√°lidos (mismo mapa)
    const CODIGOS_DESCUENTO = {
      "SKM-8Q2L9D": 3,
      "SKM-4ZP7KM": 3,
      "SKM-1V8QW3": 3,
      "SKM-9KD4LX": 3,
      "SKM-3MW7QJ": 3,
      "SKM-7PL2DX": 3,
      "SKM-2QN9FJ": 3,
      "SKM-6XQ3MD": 3,
      "SKM-4BV9QP": 3,
      "SKM-9JL3TX": 3,
      "SKM-2KV7LM": 3,
      "SKM-5QX8RD": 3,
      "SKM-8PM3ZQ": 4,
      "SKM-3QL7DX": 4,
      "SKM-7VN4KP": 4,
      "SKM-6BR2QM": 4,
      "SKM-1TZ9LQ": 4,
      "SKM-9QF3WM": 4,
      "SKM-2MP8FX": 4,
      "SKM-4QJ6ZN": 4,
      "SKM-8LD3KQ": 4,
      "SKM-5NW9QJ": 4,
      "SKM-7QF2LX": 4,
      "SKM-9TP4WD": 4,
      "SKM-3BF8KZ": 5,
      "SKM-6QZ1RM": 5,
      "SKM-2JP9DW": 5,
      "SKM-8XK4LM": 5,
      "SKM-1QM7DZ": 5,
      "SKM-7KL3QP": 5,
      "SKM-9MF2LD": 5,
      "SKM-4TP8WX": 5,
      "SKM-2BV9LQ": 5,
      "SKM-5QW1RM": 5,
      "SKM-8DJ7KM": 5,
      "SKM-3XL4DP": 5,
      "SKM-7QZ9MF": 6,
      "SKM-1LP8ZW": 6,
      "SKM-6RM3TX": 6,
      "SKM-2QN7KD": 6,
      "SKM-9WX4MP": 6,
      "SKM-4ZL2FQ": 6,
      "SKM-8QJ9TR": 6,
      "SKM-6DP1MX": 6,
      "SKM-3BL8QW": 6,
      "SKM-7FX4LZ": 6,
      "SKM-1QZ9KP": 6,
      "SKM-5LM3DF": 6,
      "SKM-9QW7ZT": 6,
      "SKM-2XP4JM": 6,
      "SKM-10XQZP": 10,
      "SKM-10LMRW": 10
    };

    const formCodigo = document.getElementById("form-codigo");
    const codigoStatus = document.getElementById("codigo-status");
    const leadSection = document.getElementById("lead-section");
    const formLead = document.getElementById("form-lead");
    const leadStatus = document.getElementById("lead-status");

    let currentCode = null;
    let currentDiscount = null;

    formCodigo.addEventListener("submit", function (e) {
      e.preventDefault();
      const code = (document.getElementById("codigo").value || "").trim().toUpperCase();

      if (!code) {
        codigoStatus.textContent = "Ingresa un c√≥digo.";
        return;
      }

      if (!CODIGOS_DESCUENTO[code]) {
        codigoStatus.textContent = "C√≥digo inv√°lido.";
        leadSection.style.display = "none";
        return;
      }

      currentCode = code;
      currentDiscount = CODIGOS_DESCUENTO[code];
      codigoStatus.textContent = "C√≥digo v√°lido. Descuento: " + currentDiscount + "%. Ahora completa tus datos.";
      leadSection.style.display = "block";
    });

    formLead.addEventListener("submit", function (e) {
      e.preventDefault();

      const nombre = (document.getElementById("nombre").value || "").trim();
      const telefono = (document.getElementById("telefono").value || "").trim();

      if (!currentCode || currentDiscount == null) {
        leadStatus.textContent = "Primero verific√° tu c√≥digo.";
        return;
      }
      if (!nombre) {
        leadStatus.textContent = "Ingresa tu nombre.";
        return;
      }
      if (!telefono) {
        leadStatus.textContent = "Ingresa tu tel√©fono.";
        return;
      }

      const payload = new URLSearchParams();
      payload.append("nombre", nombre);
      payload.append("telefono", telefono);
      payload.append("codigo", currentCode);
      payload.append("descuento", String(currentDiscount));
      payload.append("timestamp", new Date().toISOString());

      fetch(LEAD_ENDPOINT_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
        },
        body: payload.toString()
      })
        .then(res => {
          if (!res.ok) throw new Error("Error en el servidor");
          return res.text();
        })
        .then(() => {
          leadStatus.textContent = "‚úÖ Datos guardados correctamente.";
        })
        .catch(err => {
          console.error(err);
          leadStatus.textContent = "Error al guardar los datos.";
        });
    });
  </script>
</body>
</html>
